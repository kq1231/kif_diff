KifDiff Instructions for LLMs v2.0

CRITICAL WORKFLOW: Context-Aware Execution

KifDiff can operate in TWO MODES depending on your knowledge of the codebase:

DIRECT EXECUTION MODE (Preferred)
When to use: You already have the file contents from conversation context
Action: Create a .kifdiff file directly with CREATE, DELETE, OVERWRITE_FILE, MOVE, or SEARCH_AND_REPLACE operations
Skip inquiry: No need to ask for file contents you already have

INQUIRY MODE (Only When Needed)
When to use: You DON'T have the file contents or directory structure you need
Action: Create a .kifdiff file with ONLY @Kif READ and/or @Kif TREE directives
Wait: Get the inquiry results from the user before proceeding with execution

GOLDEN RULE: Only inquire when you lack necessary information!

If the user has already shared file contents, shown you code, or you have the context you need from earlier in the conversation, skip straight to execution. Don't waste time asking for information you already have.

ALWAYS USE CODE BLOCKS
ALL KifDiff content must be wrapped in code blocks. This makes it easy for users to copy and save as .kifdiff files.

Bad Example:
Here's the inquiry file:
@Kif READ lib/example.dart

Good Example:
```text
@Kif READ lib/example.dart
```

Or when you have the context:
```text
@Kif FILE /home/user/project/lib/example.dart
@Kif SEARCH_AND_REPLACE
...
```


Core Directives

@Kif FILE <absolute_path>
Specifies the target file for subsequent operations.

Important:
- Use absolute paths, not relative paths
- Required for: DELETE, SEARCH_AND_REPLACE
- Not required for: CREATE, READ, TREE, MOVE, OVERWRITE_FILE (these directives specify their own file paths)

Example:
@Kif FILE /home/user/project/lib/widgets/ui_input.dart


INQUIRY Operations (Use Only When Needed)

@Kif READ <absolute_path>
Reads a file's contents and copies it to clipboard (or prints to console).

Use ONLY when you need to:
- Examine code you haven't seen yet
- Understand implementation details not provided in conversation
- Check file structure or dependencies you're unaware of

Example:
@Kif READ /home/user/project/lib/example.dart

@Kif TREE <absolute_path>(parameters)
Displays directory structure as a visual tree.

Parameters:
- depth=N - Maximum directory depth (default: unlimited)
- show_hidden=true/false - Include hidden files (default: false)
- include_files=true/false - Show files or only directories (default: true)

Use ONLY when you need to:
- Understand project structure you don't know
- Find related files in unfamiliar directories
- Locate where to create new files when structure is unclear

Examples:
@Kif TREE /home/user/project/lib/

@Kif TREE /home/user/project/(depth=2, show_hidden=false)

@Kif TREE /home/user/project/lib/widgets/(depth=1, include_files=false)


EXECUTION Operations

1. Create File

Creates a new file (overwrites if exists).

Syntax:
@Kif CREATE <absolute_path>
... (file content) ...
@Kif END_CREATE

Important:
- Use absolute paths directly in the CREATE directive
- Does NOT require @Kif FILE directive
- Creates parent directories automatically if they don't exist
- Overwrites the file if it already exists (automatically backed up)

Example:
@Kif CREATE /home/user/project/lib/constants.dart
class AppConstants {
  static const String appName = 'My Awesome App';
  static const double defaultPadding = 16.0;
}
@Kif END_CREATE


2. Overwrite File

Completely replaces the contents of an existing file (or creates it if it doesn't exist).

Syntax:
@Kif OVERWRITE_FILE <absolute_path>
... (new file content) ...
@Kif END_OVERWRITE_FILE

Important:
- Use absolute paths directly in the OVERWRITE_FILE directive
- Does NOT require @Kif FILE directive
- Automatically backs up the existing file before overwriting
- Creates the file if it doesn't exist
- More efficient than DELETE + CREATE when replacing most of a file's content

When to use OVERWRITE_FILE vs SEARCH_AND_REPLACE:
- Use OVERWRITE_FILE when replacing more than 80% of a file's content
- Use SEARCH_AND_REPLACE for targeted changes to specific sections

Example:
@Kif OVERWRITE_FILE /home/user/project/lib/config.dart
class Config {
  static const String apiUrl = 'https://api.example.com';
  static const int timeout = 30;
}
@Kif END_OVERWRITE_FILE


3. Delete File

Deletes a file (automatically backed up).

Syntax:
@Kif FILE <absolute_path>
@Kif DELETE

Example:
@Kif FILE /home/user/project/lib/old_utils.dart
@Kif DELETE


4. Move/Rename File or Directory

Moves or renames files and directories (automatically backed up).

Syntax:
@Kif MOVE <source_path> <destination_path>

Important:
- Use absolute paths for both source and destination
- Does NOT require @Kif FILE directive
- Works for both files and directories
- Automatically creates destination directories if they don't exist
- Source file/directory is backed up before moving

Use Cases:
- Rename a file: @Kif MOVE /path/old_name.dart /path/new_name.dart
- Move to different directory: @Kif MOVE /path/file.dart /new/path/file.dart
- Rename and move: @Kif MOVE /old/path/old_name.dart /new/path/new_name.dart
- Move entire directory: @Kif MOVE /old/dir /new/dir

Examples:
Rename a file:
@Kif MOVE /home/user/project/lib/old_utils.dart /home/user/project/lib/new_utils.dart

Move file to different directory:
@Kif MOVE /home/user/project/lib/utils.dart /home/user/project/lib/helpers/utils.dart

Move and rename:
@Kif MOVE /home/user/project/lib/old_name.dart /home/user/project/lib/core/new_name.dart

Move entire directory:
@Kif MOVE /home/user/project/lib/old_widgets /home/user/project/lib/components


5. Search and Replace

Finds and replaces text blocks. Most powerful operation.

Syntax:
@Kif FILE <absolute_path>
@Kif SEARCH_AND_REPLACE(parameters)
@Kif BEFORE
... (exact text to find) ...
@Kif END_BEFORE
@Kif AFTER
... (replacement text) ...
@Kif END_AFTER
@Kif END_SEARCH_AND_REPLACE

Parameters:

- replace_all=true/false (default: false)
  true: Replace all occurrences
  false: Replace only first occurrence
  Important: Even with regex, you need replace_all=true to replace all matches

- count=N (default: 1)
  Replace exactly N occurrences
  Only works when replace_all=false
  Useful for replacing specific instances without replacing all

- regex=true/false (default: false)
  true: Treat BEFORE block as regex pattern
  false: Treat BEFORE block as literal text

- ignore_whitespace=true/false (default: false)
  true: Ignore trailing whitespace when matching
  Useful when editors auto-trim whitespace

Critical Rules:
- BEFORE block must match exactly (including whitespace)
- Use absolute paths
- Files are automatically backed up

Example - Simple Replacement:
@Kif FILE /home/user/project/lib/ui_button.dart
@Kif SEARCH_AND_REPLACE
@Kif BEFORE
  void onPressed() {
    print('Button pressed');
  }
@Kif END_BEFORE
@Kif AFTER
  void onPressed() {
    print('Button pressed');
    _handleButtonPress();
  }
@Kif END_AFTER
@Kif END_SEARCH_AND_REPLACE

Example - Replace All Occurrences:
@Kif FILE /home/user/project/lib/theme.dart
@Kif SEARCH_AND_REPLACE(replace_all=true)
@Kif BEFORE
Color.blue
@Kif END_BEFORE
@Kif AFTER
Color(0xFF2196F3)
@Kif END_AFTER
@Kif END_SEARCH_AND_REPLACE

Example - Replace Specific Count:
@Kif FILE /home/user/project/lib/logger.dart
@Kif SEARCH_AND_REPLACE(count=3)
@Kif BEFORE
print(
@Kif END_BEFORE
@Kif AFTER
debugPrint(
@Kif END_AFTER
@Kif END_SEARCH_AND_REPLACE

Example - Using Regex:
@Kif FILE /home/user/project/lib/config.dart
@Kif SEARCH_AND_REPLACE(regex=true, replace_all=true)
@Kif BEFORE
const int timeout = \d+;
@Kif END_BEFORE
@Kif AFTER
const int timeout = 5000;
@Kif END_AFTER
@Kif END_SEARCH_AND_REPLACE


Best Practices for LLMs

1. Skip Inquiry When You Have Context
If the user has already shared code, pasted file contents, or you have the information from earlier in the conversation, go straight to execution. Don't ask for information you already have.

2. Inquire Only When Necessary
Before making changes, you need to understand the codebase. But ONLY use inquiry operations (@Kif READ, @Kif TREE) when:
- You don't have the file contents
- You don't know the directory structure
- You need to see implementation details not provided

3. Write Minimal Changes
Use SEARCH_AND_REPLACE instead of rewriting entire files. Only include the specific code blocks that need modification.

Exception: When the new content is drastically different from the original file, use OVERWRITE_FILE instead of multiple SEARCH_AND_REPLACE operations.

4. Use Regex Wisely
When you need pattern matching, enable regex=true and remember to use replace_all=true if you want to replace all matches.

5. Be Precise with BEFORE Blocks
The BEFORE block must match exactly. If unsure about whitespace, use ignore_whitespace=true.

6. Use Absolute Paths
Never use relative paths. Always specify the full path from the project root.

7. Multiple Files and Operations
You can operate on multiple files and use different operations in a single .kifdiff file.

Example:
@Kif FILE /path/to/first.dart
@Kif SEARCH_AND_REPLACE
...
@Kif END_SEARCH_AND_REPLACE

@Kif FILE /path/to/second.dart
@Kif SEARCH_AND_REPLACE
...
@Kif END_SEARCH_AND_REPLACE

@Kif MOVE /path/to/old_file.dart /path/to/new_location/new_file.dart

@Kif FILE /path/to/third.dart
@Kif DELETE


Common Workflow Examples

Scenario 1: User Provides File Contents
User Request: "Here's my home_screen.dart file: [paste code]. Add a new button."

Your Response (Direct Execution):
```text
@Kif FILE /home/user/project/lib/screens/home_screen.dart
@Kif SEARCH_AND_REPLACE
@Kif BEFORE
      body: Center(
        child: Text('Welcome'),
      ),
@Kif END_BEFORE
@Kif AFTER
      body: Center(
        child: Column(
          children: [
            Text('Welcome'),
            ElevatedButton(
              onPressed: () {},
              child: Text('Click Me'),
            ),
          ],
        ),
      ),
@Kif END_AFTER
@Kif END_SEARCH_AND_REPLACE
```

Scenario 2: Unknown Codebase
User Request: "Add a new button to the home screen"

Your Response (Inquiry First):
I need to see the current home screen implementation. Please run this inquiry:
```text
@Kif READ /home/user/project/lib/screens/home_screen.dart
@Kif TREE /home/user/project/lib/widgets/
```

Once you provide the results, I'll create the changes.

[After receiving results, then provide execution file]


Remember

DO:
- Skip inquiry if you have the necessary context
- Always wrap KifDiff content in code blocks
- Use absolute paths
- Write minimal, targeted changes
- Use regex when patterns are needed

DO NOT:
- Request file contents you already have from conversation
- Make changes without understanding the code (either from context or inquiry)
- Use relative paths
- Rewrite entire files when small changes suffice
- Forget replace_all=true when using regex to replace all matches

The golden rule: Only inquire when you lack necessary information. If you have all the necessary context, feel free to execute directly.